<html>
   <script type="importmap">
      {
        "imports": {
		  "three": "./three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
        }
      }
   </script>
   <script src="./papaparse.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/geotiff"></script>
   
   <script type="module">
	// const available_tiffs1 = `ASTGTMV003_N55W002_dem.tif,ASTGTMV003_N55W003_dem.tif,ASTGTMV003_N55W004_dem.tif,ASTGTMV003_N55W005_dem.tif,ASTGTMV003_N55W006_dem.tif,ASTGTMV003_N55W007_dem.tif,ASTGTMV003_N55W008_dem.tif,ASTGTMV003_N56W003_dem.tif,ASTGTMV003_N56W004_dem.tif,ASTGTMV003_N56W005_dem.tif,ASTGTMV003_N56W006_dem.tif,ASTGTMV003_N56W007_dem.tif,ASTGTMV003_N56W008_dem.tif,ASTGTMV003_N57W002_dem.tif,ASTGTMV003_N57W003_dem.tif,ASTGTMV003_N57W004_dem.tif,ASTGTMV003_N57W005_dem.tif,ASTGTMV003_N57W006_dem.tif,ASTGTMV003_N57W007_dem.tif,ASTGTMV003_N57W008_dem.tif,ASTGTMV003_N58W003_dem.tif,ASTGTMV003_N58W004_dem.tif,ASTGTMV003_N58W005_dem.tif,ASTGTMV003_N58W006_dem.tif,ASTGTMV003_N58W007_dem.tif,ASTGTMV003_N58W008_dem.tif,ASTGTMV003_N59W002_dem.tif,ASTGTMV003_N59W003_dem.tif,ASTGTMV003_N59W004_dem.tif,ASTGTMV003_N59W005_dem.tif,ASTGTMV003_N59W006_dem.tif,ASTGTMV003_N59W007_dem.tif`
	// const available_tiffs2 = `ASTGTMV003_N55W003_dem.tif,ASTGTMV003_N55W004_dem.tif,ASTGTMV003_N55W005_dem.tif,ASTGTMV003_N56W003_dem.tif,ASTGTMV003_N56W004_dem.tif,ASTGTMV003_N56W005_dem.tif,ASTGTMV003_N57W003_dem.tif,ASTGTMV003_N57W004_dem.tif,ASTGTMV003_N57W005_dem.tif`
	// const available_tiffs3 = `ASTGTMV003_N55W003_dem.tif,ASTGTMV003_N55W004_dem.tif,ASTGTMV003_N56W003_dem.tif,ASTGTMV003_N56W004_dem.tif`
	// const available_tiffs4 = `ASTGTMV003_N56W005_dem.tif`
	// const available_tiffs = available_tiffs4.split(",")
	  
	import { mountGeoTiff, getRelevantTiffNames } from "./mountainDataHandler.js";
	
	const available_tiffs = await getRelevantTiffNames();

      // create three.js scene+renderer and add camera+orbitcontrols
      import * as THREE from "three";
      const scene = new THREE.Scene();

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 200000);
	  camera.position.x = -36000;
      camera.position.y = 3000;
      camera.position.z = -9600;

      import {
      	OrbitControls
      } from "three/addons/controls/OrbitControls.js";
      const controls = new OrbitControls(camera, renderer.domElement);
	  // controls.panSpeed = 10
	  // controls.zoomSpeed = 10

      // define and start animation loop
      function animate() {
      	requestAnimationFrame(animate);

      	//plane.rotation.x += 0.01;
      	//plane.rotation.y += 0.01;

      	controls.update();
      	renderer.render(scene, camera);
      }
      animate();

      // load tiffs into scene and position correctly according to lat/long
      	available_tiffs.map((filename) => {
		  try {
				console.log("trying to mount", "/geotiff_data/" + filename);
				mountGeoTiff("/geotiff_data/" + filename, scene);
		  } catch (e) {
			console.log("encountered error during loading", "/geotiff_data/" + filename)
			console.log(e)
		  }
      })
      console.log("script has logged off")
   </script>
</html>